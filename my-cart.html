<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>My Cart | Carita Hidroponik</title>
    <link rel="icon" type="image/x-icon" href="img/Logo.jpg" />
    <!-- ========== STYLE ========== -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/my-cart.css" />
    <link rel="stylesheet" href="css/mobile.css" media="(max-width: 768px)" />

    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <body x-data @alpine:init="
    $store.products.init();
    $store.cart.init();
  ">
    <div id="header-include"></div>

    <main class="main-content" x-data="checkoutPage">
      <section class="cart-section">
        <div class="container">
          <h2 class="section-title" x-text="$store.i18n.t('cart.title')">Shopping Cart</h2>
          <div class="cart-layout">
            <!-- CART ITEMS -->
            <div class="cart-items-container">
              <div class="cart-header">
                <div class="header-product" x-text="$store.i18n.t('cart.header.product')">Product</div>
                <div class="header-quantity" x-text="$store.i18n.t('cart.header.quantity')">Quantity</div>
                <div class="header-total" x-text="$store.i18n.t('cart.header.total')">Total</div>
                <div class="header-remove" aria-hidden="true"></div>
              </div>

              <div id="cart-items-list">
                <template x-if="$store.cart.items.length === 0">
                  <p class="cart-empty-message" x-text="$store.i18n.t('cart.emptyMessage')">Your shopping cart is empty.</p>
                </template>

                <template x-for="item in $store.cart.details" :key="item.id" x-init="$nextTick(() => feather.replace())">
                  <div class="cart-item">
                    <div class="cart-item-product">
                      <img :src="item.img" :alt="item.name" class="cart-item-image" />
                      <div class="cart-item-details">
                        <h4 class="item-name" x-text="item.name"></h4>
                        <div class="price-container-cart">
                          <template x-if="item.percentOff > 0">
                            <div>
                              <span class="item-price-original" x-text="window.formatRupiah(item.price)"></span>
                              <span class="item-price-final" x-text="window.formatRupiah(item.finalPrice)"></span>
                            </div>
                          </template>
                          <template x-if="!(item.percentOff > 0)">
                            <div class="item-price" x-text="window.formatRupiah(item.price)"></div>
                          </template>
                        </div>
                      </div>
                    </div>
                    <div class="cart-item-quantity">
                      <button class="quantity-btn" @click="$store.cart.remove(item.id)" aria-label="Decrease">-</button>
                      <span class="quantity-value" x-text="item.quantity"></span>
                      <button class="quantity-btn" @click="$store.cart.add(item.id)" aria-label="Increase">+</button>
                    </div>
                    <div class="cart-item-total" x-text="window.formatRupiah(item.subtotal)"></div>
                    <button class="cart-item-remove" @click="$store.cart.remove(item.id, true)" aria-label="Remove item">
                      <i data-feather="trash-2"></i>
                    </button>
                  </div>
                </template>
              </div>

              <a href="index.html#Product" class="continue-shopping">
                <i data-feather="arrow-left"></i> <span x-text="$store.i18n.t('cart.continueShopping')">Continue Shopping</span>
              </a>
            </div>

            <!-- SUMMARY -->
            <div class="cart-summary">
              <h3 x-text="$store.i18n.t('cart.summary.title')">Order Summary</h3>

              <div class="coupon-form">
                <input type="text" :placeholder="$store.i18n.t('cart.summary.couponPlaceholder')" />
                <button class="btn btn-secondary" x-text="$store.i18n.t('cart.summary.applyButton')">Apply</button>
              </div>

              <div class="summary-item">
                <span x-text="$store.i18n.t('cart.summary.subtotal')">Subtotal</span>
                <span id="summary-subtotal" x-text="window.formatRupiah($store.cart.total)"></span>
              </div>
              <div class="summary-item">
                <span x-text="$store.i18n.t('cart.summary.shipping')">Shipping</span>
                <span id="summary-shipping">Rp 0</span>
              </div>

              <div class="summary-total">
                <span x-text="$store.i18n.t('cart.summary.total')">Total</span>
                <span id="summary-total" x-text="window.formatRupiah($store.cart.total)"></span>
              </div>

              <button
                @click="handleCheckout()"
                class="btn btn-primary btn-block"
                :disabled="$store.cart.items.length === 0"
                x-text="$store.i18n.t('cart.summary.checkoutButton')"
              >
                Proceed to Checkout
              </button>
            </div>
          </div>
        </div>
        </div>
      </section>

      <!-- ========== NOTIFICATION MODAL ========== -->
      <div x-show="isProfileModalOpen" :class="{'show': isProfileModalOpen}" class="modal-overlay cart-modal-overlay">
        <div class="modal-content" @click.outside="isProfileModalOpen = false">
          <h3 class="modal-title" x-text="$store.i18n.t('cart.modal.profileIncomplete.title')">Profile Incomplete</h3>
          <p class="modal-body" x-text="$store.i18n.t('cart.modal.profileIncomplete.body')">
            To proceed with checkout, you must complete your profile information
            first.
          </p>
          <div class="modal-actions">
            <button
              @click="isProfileModalOpen = false"
              class="btn btn-secondary"
              x-text="$store.i18n.t('cart.modal.profileIncomplete.laterButton')"
            >
              Later
            </button>
            <a href="my-account.html" class="btn btn-primary"
            x-text="$store.i18n.t('cart.modal.profileIncomplete.completeButton')"
              >Complete Profile</a
            >
          </div>
        </div>
      </div>

      <div id="notification" class="notification"></div>

      <div
        x-show="isLoginModalOpen"
        :class="{'show': isLoginModalOpen}"
        class="modal-overlay cart-modal-overlay"
      >
        <div class="modal-content" @click.outside="isLoginModalOpen = false">
          <h3 class="modal-title" x-text="$store.i18n.t('cart.modal.notLoggedIn.title')">You Are Not Logged In</h3>
          <p class="modal-body" x-text="$store.i18n.t('cart.modal.notLoggedIn.body')">
            Please log in or create an account to continue with the checkout
            process.
          </p>
          <div class="modal-actions">
            <button
              @click="isLoginModalOpen = false"
              class="btn btn-secondary"
              x-text="$store.i18n.t('cart.modal.notLoggedIn.closeButton')"
            >
              Close
            </button>
            <a href="login-page.html" class="btn btn-primary"
            x-text="$store.i18n.t('cart.modal.notLoggedIn.loginButton')"
              >Login or Register</a
            >
          </div>
        </div>
      </div>

      <div
        x-show="isConfirmModalOpen"
        :class="{'show': isConfirmModalOpen}"
        class="modal-overlay cart-modal-overlay"
      >
        <div class="modal-content" @click.outside="isConfirmModalOpen = false">
          <h3 class="modal-title" x-text="$store.i18n.t('cart.modal.confirmOrder.title')">Confirm Your Order</h3>
          <div class="confirmation-summary">
            <template x-for="item in $store.cart.details" :key="item.id">
              <div class="summary-product-item">
                <span
                  class="summary-product-name"
                  x-text="`${item.name} (x${item.quantity})`"
                ></span>
                <span
                  class="summary-product-total"
                  x-text="window.formatRupiah(item.subtotal)"
                ></span>
              </div>
            </template>
            <div class="summary-grand-total">
              <span
                x-text="`${$store.i18n.t('cart.summary.total')}: ${window.formatRupiah($store.cart.total)}`"
              ></span>
            </div>
          </div>
          <div class="modal-actions">
            <button
              @click="isConfirmModalOpen = false"
              class="btn btn-secondary"
              x-text="$store.i18n.t('cart.modal.confirmOrder.cancelButton')"
            >
              Cancel
            </button>
            <button
              @click="confirmAndProcessCheckout()"
              class="btn btn-primary"
              x-text="$store.i18n.t('cart.modal.confirmOrder.confirmButton')"
            >
              Confirm & Order
            </button>
          </div>
        </div>
      </div>
    </main>

    <div id="footer-include"></div>

    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.10/dist/cdn.min.js?nounit=true"></script>
  </body>
</html>
