<!-- ================= LANGUAGE SWITCHER DROPDOWN FIX ================= -->
<style>
  .user-dropdown {
    position: relative;
    display: inline-block;
  }

  .dropdown-content {
    position: absolute;
    right: 0;
    background-color: #fff;
    box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
    z-index: 100;
    border-radius: 6px;
    overflow: visible;
  }

  /* === Language Switcher === */
  .lang-switcher {
    position: relative;
    display: inline-block;
  }

  .lang-switcher button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
  }

  .lang-switcher .dropdown-content {
    display: flex;
    align-items: center;
    gap: 6px;

    padding: 6px;
    min-width: 48px;        /* ✅ FIX: prevent collapse */
    min-height: 40px;       /* ✅ FIX: ensure visibility */

    background-color: #fff;
    border-radius: 6px;
    white-space: nowrap;
  }

  .lang-switcher .dropdown-content a {
    display: flex;
    align-items: center;
    justify-content: center;

    padding: 4px;
    border-radius: 4px;
    line-height: 1;
  }

  .lang-switcher .dropdown-content a:hover {
    background-color: #f1f1f1;
  }

  .flag-icon {
    width: 24px;
    height: 24px;
    border-radius: 9999px;
    display: block;
  }
</style>

<!-- ================= HEADER ================= -->
<header x-data="headerComponent()" class="topbar">
  <div id="notification"></div>

  <div class="container topbar-inner">
    <div class="brand">
      <a href="index.html">
        <img src="img/Logo Putih.png" alt="Carita Hidroponik" class="brand-logo" />
      </a>
    </div>

    <div class="top-actions">
      <!-- User Icon -->
      <a :href="profileLink" class="header-icon" aria-label="Account">
        <i data-feather="user"></i>
      </a>

      <!-- Cart Icon -->
      <a href="my cart.html" class="header-icon icon-btn" aria-label="Cart">
        <i data-feather="shopping-cart"></i>
        <span id="cart-count"
              class="badge"
              x-show="$store.cart.quantity > 0"
              x-text="$store.cart.quantity"></span>
      </a>

      <!-- Language Switcher -->
      <div id="language-switcher"
           x-data="{ open: false }"
           @click.away="open = false"
           class="lang-switcher">

        <button @click="open = !open"
                class="header-icon"
                :aria-label="'Current language: ' + $store.i18n.supportedLangs[$store.i18n.lang]">

          <img
            :src="$store.i18n.lang === 'en'
              ? 'https://cdn.jsdelivr.net/npm/flag-icons@latest/flags/1x1/gb.svg'
              : 'https://cdn.jsdelivr.net/npm/flag-icons@latest/flags/1x1/id.svg'"
            class="flag-icon"
            :alt="$store.i18n.supportedLangs[$store.i18n.lang]">
        </button>

        <div x-show="open" x-transition class="dropdown-content">
          <template
            x-for="lang in Object.keys($store.i18n.supportedLangs).filter(l => l !== $store.i18n.lang)"
            :key="lang">

            <a href="#"
               @click.prevent="$store.i18n.setLang(lang); open = false"
               :aria-label="'Switch language to ' + $store.i18n.supportedLangs[lang]">

              <img
                :src="lang === 'en'
                  ? 'https://cdn.jsdelivr.net/npm/flag-icons@latest/flags/1x1/gb.svg'
                  : 'https://cdn.jsdelivr.net/npm/flag-icons@latest/flags/1x1/id.svg'"
                class="flag-icon"
                :alt="$store.i18n.supportedLangs[lang]">
            </a>

          </template>
        </div>
      </div>

      <!-- Hamburger (Mobile) -->
      <template x-if="isOnIndexPage">
        <button @click="toggleMobileMenu()"
                id="menu-toggle"
                class="icon-btn"
                aria-label="Buka Menu">
          <i data-feather="menu"></i>
        </button>
      </template>
    </div>
  </div>
</header>

<script>
  function headerComponent() {
    return {
      profileLink: 'login-page.html',
      isOnIndexPage:
        window.location.pathname.endsWith('index.html') ||
        window.location.pathname === '/',

      init() {
        const supabaseSessionKey = Object.keys(sessionStorage)
          .find(key => key.startsWith('sb-'));
        if (supabaseSessionKey) {
          this.profileLink = 'my-account.html';
        }
      },

      toggleMobileMenu() {
        const sidebar = document.getElementById("categorySidebar");
        if (sidebar) {
          sidebar.classList.toggle("mobile-active");
          document.body.classList.toggle("sidebar-open");
        }
      }
    }
  }
</script>
